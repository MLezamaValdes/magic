<!DOCTYPE html>
<html lang="en">
<head>
<title>Export Time Series - choose region</title>
<meta name="robots" content="noindex" />
<meta charset="utf-8">
<link rel="icon" type="image/png" href="favicon.png" />

<style type="text/css">
#top_line {display: table; width: 100%; }
#top_line_left {display: table-cell; text-align: left; }
#top_line_right {display: table-cell; text-align: right; }
h1 {margin-bottom: 40px; text-align:center;}
</style>

<script src="jquery-2.1.1.min.js"></script>
<script src="jquery-ui.min.js"></script>
<script src="util.js"></script>
<script type="text/javascript">

var tasks = 0;

var region_radios = [];

var incTask = function() {
	tasks++;	
	getID("status").innerHTML = "busy ("+tasks+")...";
}

var decTask = function() {
	tasks--;
	if(tasks===0) {
		getID("status").innerHTML = "ready";
	} else if(tasks<0){
		getID("status").innerHTML = "error";
	} else {
		getID("status").innerHTML = "busy ("+tasks+")...";
	}
}

var getRegion = function() {
	incTask();
	$.get("../export/region").done(function(data) {
		var rows = splitData(data);	
		var region = rows[0][0];
		getID(region).checked = true;
		decTask();
	}).fail(function() {alert("error getting data");decTask();});
}

var updataRegions = function() {
	incTask();
	var region_div = getID("region_div");
	region_div.innerHTML = "";
	$.get("../tsdb/region_list").done(function(data) {
		var rows = splitData(data);
		$.each(rows, function(i,row) {
			var radio = document.createElement("input");
			radio.setAttribute("type", "radio");
			radio.name = "reg";
			radio.id = row[0];
			var p = region_div.appendChild(document.createElement("p"));
			p.appendChild(radio);
			p.appendChild(document.createTextNode(row[1]));
			region_radios.push(radio);
		});
		getRegion();
	    decTask();
	}).fail(function() {region_select.append(new Option("[error]","[error]"));decTask();});
}

var on_cancel = function() {
	window.location = "export.html";
}

var on_apply = function() {
	var region = "[region]";
	for(i in region_radios) {
		if(region_radios[i].checked) {
			region = region_radios[i].id;
		}
	}
	incTask();	
	$.post("../export/apply_region?region="+region,region)
		 .done(function() {
			window.location = "export.html";
			decTask();
		 })
		 .fail(function(jqXHR, textStatus, errorThrown) {
			alert("error sending settings data: "+textStatus+"  "+errorThrown);
			decTask();
		 });	
}

var ready = function() {
	incTask();
	updataRegions();
	document.getElementById("button_cancel").onclick = on_cancel;
	document.getElementById("button_apply").onclick = on_apply;
	decTask();
	//$("button").button();
}

$(document).ready(ready);

</script>

<link rel="stylesheet" href="jquery-ui.css">
<link rel="stylesheet" type="text/css" href="querytimeseries.css">

</head>

<body>
<div class="bg">


<div id="top_line">
<div id="top_line_left">
<div style="display:inline-block">status:</div>
<div id="status" style="display:inline-block">init...</div>
</div>
<div id="top_line_right">
<a href="..">main-page</a>
<button onclick="var h=$('#div_help')[0].style;h.display=(h.display=='none')?'inline':'none'">?</button>
</div> 
</div>





<h1>Export Time Series - choose region</h1>

<button id="button_cancel">cancel</button>
<button id="button_apply">apply region</button>
<hr/>
</div>
<div id="div_help" style="display:none">
<h3>Help</h3>
On this page you can change the region of plots you are interested in. click on "cancel" to discard changed. click on "apply region" to confirm changes.
<hr/>
</div>
<h3>Region</h3>
<div id="region_div" style="display:inline-block">
<p><input type="radio" name="reg" value="0" checked="checked" />region1</p>
<p><input type="radio" name="reg" value="1" checked="checked" />region2</p>
<p><input type="radio" name="reg" value="2" checked="checked" />region3</p>
</div>



</body>
</html>