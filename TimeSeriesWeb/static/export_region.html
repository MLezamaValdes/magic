<!DOCTYPE html>
<html lang="en">
<head>
<title>Export Time Series - choose region</title>
<meta charset="utf-8">
<script src="/static/jquery-2.1.1.min.js"></script>
<script src="jquery-ui.min.js"></script>
<script src="/static/util.js"></script>
<script type="text/javascript">

var tasks = 0;

var region_radios = [];

var incTask = function() {
	tasks++;	
	getID("status").innerHTML = "busy ("+tasks+")...";
}

var decTask = function() {
	tasks--;
	if(tasks===0) {
		getID("status").innerHTML = "ready";
	} else if(tasks<0){
		getID("status").innerHTML = "error";
	} else {
		getID("status").innerHTML = "busy ("+tasks+")...";
	}
}

var getRegion = function() {
	incTask();
	$.get("/export/region").done(function(data) {
		var rows = splitData(data);	
		var region = rows[0][0];
		getID(region).checked = true;
		decTask();
	}).fail(function() {alert("error getting data");decTask();});
}

var updataRegions = function() {
	incTask();
	var region_div = getID("region_div");
	region_div.innerHTML = "";
	$.get("/tsdb/region_list").done(function(data) {
		var rows = splitData(data);
		$.each(rows, function(i,row) {
			var radio = document.createElement("input");
			radio.setAttribute("type", "radio");
			radio.name = "reg";
			radio.id = row[0];
			var p = region_div.appendChild(document.createElement("p"));
			p.appendChild(radio);
			p.appendChild(document.createTextNode(row[1]));
			region_radios.push(radio);
		});
		getRegion();
	    decTask();
	}).fail(function() {region_select.append(new Option("[error]","[error]"));decTask();});
}

var on_cancel = function() {
	window.location = "/static/export.html";
}

var on_apply = function() {
	var region = "[region]";
	for(i in region_radios) {
		if(region_radios[i].checked) {
			region = region_radios[i].id;
		}
	}
	incTask();	
	$.post("/export/apply_region?region="+region,region)
		 .done(function() {
			window.location = "/static/export.html";
			decTask();
		 })
		 .fail(function(jqXHR, textStatus, errorThrown) {
			alert("error sending settings data: "+textStatus+"  "+errorThrown);
			decTask();
		 });	
}

var ready = function() {
	incTask();
	updataRegions();
	document.getElementById("button_cancel").onclick = on_cancel;
	document.getElementById("button_apply").onclick = on_apply;
	decTask();
}

$(document).ready(ready);

</script>

<link rel="stylesheet" href="jquery-ui.css">
<link rel="stylesheet" type="text/css" href="querytimeseries.css">

</head>

<body>

<p style="text-align:right"><a href="/static/export.html">back to Export Time Series</a></p>
<h1 style="text-align:center">Export Time Series - choose region</h1>
<div style="display:inline-block">status:</div>
<div id="status" style="display:inline-block">init...</div>
<hr/>
<h3>Actions</h3>
<button id="button_cancel">cancel</button>
<button id="button_apply">apply settings</button>
<hr/>
<h3>Region</h3>
<div id="region_div" style="display:inline-block">
<p><input type="radio" name="reg" value="0" checked="checked" />region1</p>
<p><input type="radio" name="reg" value="1" checked="checked" />region2</p>
<p><input type="radio" name="reg" value="2" checked="checked" />region3</p>
</div>



</body>
</html>