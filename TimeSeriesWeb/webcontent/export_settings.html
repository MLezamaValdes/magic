<!DOCTYPE html>
<html lang="en">
<head>
<title>Export Time Series - settings</title>
<meta name="robots" content="noindex" />
<meta charset="utf-8">
<link rel="icon" type="image/png" href="favicon.png" />

<style type="text/css">
#top_line {display: table; width: 100%; }
#top_line_left {display: table-cell; text-align: left; }
#top_line_right {display: table-cell; text-align: right; }
h1 {margin-bottom: 40px; text-align:center;}
</style>

<script src="jquery-2.1.1.min.js"></script>
<script src="jquery-ui.min.js"></script>
<script src="util.js"></script>
<script type="text/javascript">

var tasks = 0;

var incTask = function() {
	tasks++;	
	getID("status").innerHTML = "busy ("+tasks+")...";
}

var decTask = function() {
	tasks--;
	if(tasks===0) {
		getID("status").innerHTML = "ready";
	} else if(tasks<0){
		getID("status").innerHTML = "error";
	} else {
		getID("status").innerHTML = "busy ("+tasks+")...";
	}
}

var json_settings;

$(document).ready(function(){
	incTask();	
	//$("#button_cancel").button();
	document.getElementById("button_cancel").onclick = function() {
		window.location = "export.html";
	}
	
	//$("#button_apply").button();
	document.getElementById("button_apply").onclick = function() {
		incTask();
		
		json_settings.interpolate = document.getElementById("interpolate").checked;
		json_settings.desc_sensor = document.getElementById("desc_sensor").checked;
		json_settings.desc_plot = document.getElementById("desc_plot").checked;
		json_settings.desc_settings = document.getElementById("desc_settings").checked;
		json_settings.allinone = document.getElementById("allinone").checked;
		json_settings.quality = document.getElementById("choose_quality").value;
		json_settings.col_plotid = document.getElementById("col_plotid").checked;
		json_settings.col_timestamp = document.getElementById("col_timestamp").checked;
		json_settings.col_datetime = document.getElementById("col_datetime").checked;
		json_settings.col_qualitycounter = document.getElementById("col_qualitycounter").checked;
		json_settings.write_header = document.getElementById("write_header").checked;

		$.postJSON("../export/apply_settings",json_settings)
		 .done(function() {
			window.location = "export.html";
			decTask();
		 })
		 .fail(function(jqXHR, textStatus, errorThrown) {alert("error sending settings data: "+textStatus+"  "+errorThrown);decTask();});	
	 
	}
	
	incTask();
	$.getJSON("../export/settings").done(function( data ) {
		json_settings = data;
		console.log(json_settings);
		
		document.getElementById("interpolate").checked = json_settings.interpolate;
		document.getElementById("desc_sensor").checked = json_settings.desc_sensor;
		document.getElementById("desc_plot").checked = json_settings.desc_plot;
		document.getElementById("desc_settings").checked = json_settings.desc_settings;
		document.getElementById("allinone").checked = json_settings.allinone;
		document.getElementById("choose_quality").value = json_settings.quality;
		document.getElementById("col_plotid").checked = json_settings.col_plotid;
		document.getElementById("col_timestamp").checked = json_settings.col_timestamp;
		document.getElementById("col_datetime").checked = json_settings.col_datetime;
		document.getElementById("col_qualitycounter").checked = json_settings.col_qualitycounter;
		document.getElementById("write_header").checked = json_settings.write_header;
		
		var raw = false;
		if(json_settings.timestep=="raw") {
			raw = true;
			document.getElementById("interpolate").disabled = true;
			document.getElementById("div_interpolate").style.color = "silver";
			document.getElementById("choose_quality").disabled = true;
			document.getElementById("div_quality").style.color = "silver";
		}		
		
		
		decTask();
	})
	.fail(function(data) {alert("error getting settings data: "+data);decTask();});

	decTask();
});

</script>

<link rel="stylesheet" href="jquery-ui.css">
<link rel="stylesheet" type="text/css" href="querytimeseries.css">

</head>

<body>
<div class="bg">

<div id="top_line">
<div id="top_line_left">
<div style="display:inline-block">status:</div>
<div id="status" style="display:inline-block">init...</div>
</div>
<div id="top_line_right">
<a href="..">main-page</a>
<button onclick="var h=$('#div_help')[0].style;h.display=(h.display=='none')?'inline':'none'">?</button>
</div> 
</div>
<h1>Export Time Series - settings</h1>




<button id="button_cancel">cancel</button>
<button id="button_apply">apply settings</button>
<hr/>
</div>
<div id="div_help" style="display:none">
<h3>Help</h3>
On this page you can choose some setting of the zip file containing the exported data. Click on "cancel" to discard changed. Click on "apply settings" to confirm changes.
<hr/>
</div>
<h3>Settings</h3>

<p>

<div id="div_quality">
<label for="choose_quality">quality check of measured values</label>
<select id="choose_quality">
<option value="no">0: no quality check</option>
<option value="physical">1: just physical range check</option>
<option value="step">2: physical range + step range check</option>
<option value="empirical">3: physical range + step + empirical check</option>
</select>
</div>

</p>

<h4>options</h4>
<div id="div_interpolate">
<p><input type="checkbox" id="interpolate"><label for="interpolate">try to interpolate missing data</label></p>
</div>
<p><input type="checkbox" id="allinone"><label for="allinone">write all plots in one CSV-File</label></p>
<p><input type="checkbox" id="write_header"><label for="write_header">write header in CSV-Files</label></p>
<h4>columns in CSV-Files</h4>
<p><input type="checkbox" id="col_plotid"><label for="col_plotid">include column &quot;<i>plotID</i>&quot;</label></p>
<p><input type="checkbox" id="col_timestamp"><label for="col_timestamp">include column &quot;<i>timestamp</i>&quot;  (time in minutes since 1899-12-30T00:00 - based on OLE Automation Time)</label></p>
<p><input type="checkbox" id="col_datetime"><label for="col_datetime">include column &quot;<i>datetime</i>&quot; (according to ISO 8601: {yyyy-mm-ddThh}  [year]-[month]-[day]T[hour]  )</label></p>
<p><input type="checkbox" id="col_qualitycounter"><label for="col_qualitycounter">include column &quot;<i>qualitycounter</i>&quot; (counters of aggregated values: {c[COUNT]i[COUNT]_c[COUNT]...}  example <i>c99i3_c20i0</i>: first parameter with 99 values in aggregate of which 3 are interpolated, second parameter 20 values no interpolation  )</label></p>
<h4>additional files in ZIP-archive</h4>
<p><input type="checkbox" id="desc_sensor"><label for="desc_sensor">parameter (sensor) description</label></p>
<p><input type="checkbox" id="desc_plot"><label for="desc_plot">plot description</label></p>
<p><input type="checkbox" id="desc_settings"><label for="desc_settings">info about used settings</label></p>


<p>

</p>



</body>
</html>